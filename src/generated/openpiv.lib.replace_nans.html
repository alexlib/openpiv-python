<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>openpiv.lib.replace_nans &mdash; OpenPIV  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> OpenPIV
          </a>
              <div class="version">
                0.24.4a
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../piv_basics.html">Basics of the PIV algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation_instruction.html">Installation instruction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial1.html">OpenPIV tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../windef.html">Multi-grid window deformation algorithm tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../masking.html">OpenPIV masking tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers.html">Information for developers and contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions about PIV parameters</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">OpenPIV</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>openpiv.lib.replace_nans</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/src/generated/openpiv.lib.replace_nans.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="openpiv-lib-replace-nans">
<h1>openpiv.lib.replace_nans<a class="headerlink" href="#openpiv-lib-replace-nans" title="Permalink to this heading"></a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="openpiv.lib.replace_nans">
<span class="sig-prename descclassname"><span class="pre">openpiv.lib.</span></span><span class="sig-name descname"><span class="pre">replace_nans</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'disk'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/openpiv/lib.html#replace_nans"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#openpiv.lib.replace_nans" title="Permalink to this definition"></a></dt>
<dd><dl class="simple">
<dt>Replace NaN elements in an array using an iterative image inpainting</dt><dd><p>algorithm.</p>
</dd>
</dl>
<p>The algorithm is the following:</p>
<ol class="arabic simple">
<li><p>For each element in the input array, replace it by a weighted average
of the neighbouring elements which are not NaN themselves. The weights
depend on the method type. See Methods below.</p></li>
<li><p>Several iterations are needed if there are adjacent NaN elements.
If this is the case, information is “spread” from the edges of the
missing regions iteratively, until the variation is below a certain
threshold.</p></li>
</ol>
<p>Methods:</p>
<dl>
<dt>localmean - A square kernel where all elements have the same value,</dt><dd><p>weights are equal to n/( (2*kernel_size+1)**2 -1 ),
where n is the number of non-NaN elements.</p>
</dd>
<dt>disk - A circular kernel where all elements have the same value,</dt><dd><dl class="simple">
<dt>kernel is calculated by::</dt><dd><dl class="simple">
<dt>if ((S-i)**2 + (S-j)**2)**0.5 &lt;= S:</dt><dd><p>kernel[i,j] = 1.0</p>
</dd>
<dt>else:</dt><dd><p>kernel[i,j] = 0.0</p>
</dd>
</dl>
</dd>
</dl>
<p>where S is the kernel radius.</p>
</dd>
<dt>distance - A circular inverse distance kernel where elements are</dt><dd><p>weighted proportional to their distance away from the
center of the kernel, elements farther away have less
weight. Elements outside the specified radius are set
to 0.0 as in ‘disk’, the remaining of the weights are
calculated as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">maxDist</span> <span class="o">=</span> <span class="p">((</span><span class="n">S</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">S</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
<span class="n">kernel</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="p">(((</span><span class="n">S</span><span class="o">-</span><span class="n">i</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">S</span><span class="o">-</span><span class="n">j</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">maxDist</span><span class="p">)</span>
</pre></div>
</div>
<p>where S is the kernel radius.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>array</strong> (<em>2d</em><em> or </em><em>3d np.ndarray</em>) – an array containing NaN elements that have to be replaced
if array is a masked array (numpy.ma.MaskedArray), then
the mask is reapplied after the replacement</p></li>
<li><p><strong>max_iter</strong> (<em>int</em>) – the number of iterations</p></li>
<li><p><strong>tol</strong> (<em>float</em>) – On each iteration check if the mean square difference between
values of replaced elements is below a certain tolerance <cite>tol</cite></p></li>
<li><p><strong>kernel_size</strong> (<em>int</em>) – the size of the kernel, default is 1</p></li>
<li><p><strong>method</strong> (<em>str</em>) – the method used to replace invalid values. Valid options are
<cite>localmean</cite>, <cite>disk</cite>, and <cite>distance</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>filled</strong> – a copy of the input array, where NaN elements have been replaced.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>2d or 3d np.ndarray</p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014, OpenPIV team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>